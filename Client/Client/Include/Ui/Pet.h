/********************************************************************
Created by UIEditor.exe
FileName: F:\work_hero\next\Program\trunk\Bin\Client\Data\Ui\Pet.h
*********************************************************************/
#pragma once
#include "MeUi/MeUi.h"
#include "GlobalDef.h"
#include "PlayerAnimCtrl.h"
#include "UiBase.h"

#ifndef ID_FRAME_Pet
#define ID_FRAME_Pet		"ID_FRAME_Pet"
#endif  ID_FRAME_Pet
#ifndef ID_TEXT_MJ
#define ID_TEXT_MJ		"ID_TEXT_MJ"
#endif  ID_TEXT_MJ
#ifndef ID_TEXT_LL
#define ID_TEXT_LL		"ID_TEXT_LL"
#endif  ID_TEXT_LL
#ifndef ID_TEXT_TZ
#define ID_TEXT_TZ		"ID_TEXT_TZ"
#endif  ID_TEXT_TZ
#ifndef ID_TEXT_SF
#define ID_TEXT_SF		"ID_TEXT_SF"
#endif  ID_TEXT_SF
#ifndef ID_TEXT_SYDJ
#define ID_TEXT_SYDJ		"ID_TEXT_SYDJ"
#endif  ID_TEXT_SYDJ
#ifndef ID_TEXT_KLD
#define ID_TEXT_KLD		"ID_TEXT_KLD"
#endif  ID_TEXT_KLD
#ifndef ID_TEXT_name
#define ID_TEXT_name		"ID_TEXT_name"
#endif  ID_TEXT_name
#ifndef ID_TEXT_LLZZ
#define ID_TEXT_LLZZ		"ID_TEXT_LLZZ"
#endif  ID_TEXT_LLZZ
#ifndef ID_TEXT_JRZZ
#define ID_TEXT_JRZZ		"ID_TEXT_JRZZ"
#endif  ID_TEXT_JRZZ
#ifndef ID_TEXT_TZZZ
#define ID_TEXT_TZZZ		"ID_TEXT_TZZZ"
#endif  ID_TEXT_TZZZ
#ifndef ID_TEXT_SFZZ
#define ID_TEXT_SFZZ		"ID_TEXT_SFZZ"
#endif  ID_TEXT_SFZZ
#ifndef ID_LIST_ShouLan
#define ID_LIST_ShouLan		"ID_LIST_ShouLan"
#endif  ID_LIST_ShouLan
#ifndef ID_BUTTON_XiuXi
#define ID_BUTTON_XiuXi		"ID_BUTTON_XiuXi"
#endif  ID_BUTTON_XiuXi
#ifndef ID_TEXT_DJ
#define ID_TEXT_DJ		"ID_TEXT_DJ"
#endif  ID_TEXT_DJ
#ifndef ID_PICTURE_Yingxiang
#define ID_PICTURE_Yingxiang		"ID_PICTURE_Yingxiang"
#endif  ID_PICTURE_Yingxiang
#ifndef ID_LISTIMG_ZhuDong
#define ID_LISTIMG_ZhuDong		"ID_LISTIMG_ZhuDong"
#endif  ID_LISTIMG_ZhuDong
#ifndef ID_TEXT_Exp
#define ID_TEXT_Exp		"ID_TEXT_Exp"
#endif  ID_TEXT_Exp
#ifndef ID_BUTTON_Right
#define ID_BUTTON_Right		"ID_BUTTON_Right"
#endif  ID_BUTTON_Right
#ifndef ID_BUTTON_Left
#define ID_BUTTON_Left		"ID_BUTTON_Left"
#endif  ID_BUTTON_Left
#ifndef ID_TEXT_TakeNum
#define ID_TEXT_TakeNum		"ID_TEXT_TakeNum"
#endif  ID_TEXT_TakeNum
#ifndef ID_BUTTON_Feed
#define ID_BUTTON_Feed		"ID_BUTTON_Feed"
#endif  ID_BUTTON_Feed
#ifndef ID_LISTIMG_PetIcon
#define ID_LISTIMG_PetIcon		"ID_LISTIMG_PetIcon"
#endif  ID_LISTIMG_PetIcon
#ifndef ID_LISTIMG_QiCheng
#define ID_LISTIMG_QiCheng		"ID_LISTIMG_QiCheng"
#endif  ID_LISTIMG_QiCheng
#ifndef ID_TEXT_MountName
#define ID_TEXT_MountName		"ID_TEXT_MountName"
#endif  ID_TEXT_MountName
#ifndef ID_BUTTON_ChuZhan
#define ID_BUTTON_ChuZhan		"ID_BUTTON_ChuZhan"
#endif  ID_BUTTON_ChuZhan
#ifndef ID_BUTTON_FangSheng
#define ID_BUTTON_FangSheng		"ID_BUTTON_FangSheng"
#endif  ID_BUTTON_FangSheng
#ifndef ID_BUTTON_Lock
#define ID_BUTTON_Lock		"ID_BUTTON_Lock"
#endif  ID_BUTTON_Lock
#ifndef ID_BUTTON_UnLock
#define ID_BUTTON_UnLock		"ID_BUTTON_UnLock"
#endif  ID_BUTTON_UnLock
#ifndef ID_TEXT_Name
#define ID_TEXT_Name		"ID_TEXT_Name"
#endif  ID_TEXT_Name
#ifndef ID_BUTTON_GaiMing
#define ID_BUTTON_GaiMing		"ID_BUTTON_GaiMing"
#endif  ID_BUTTON_GaiMing
#ifndef ID_BUTTON_Renew
#define ID_BUTTON_Renew		"ID_BUTTON_Renew"
#endif  ID_BUTTON_Renew
#ifndef ID_BUTTON_Confirm
#define ID_BUTTON_Confirm		"ID_BUTTON_Confirm"
#endif  ID_BUTTON_Confirm
#ifndef ID_LISTIMG_BeiDong
#define ID_LISTIMG_BeiDong		"ID_LISTIMG_BeiDong"
#endif  ID_LISTIMG_BeiDong
#ifndef ID_TEXT_Generation
#define ID_TEXT_Generation		"ID_TEXT_Generation"
#endif  ID_TEXT_Generation
#ifndef ID_TEXT_Point
#define ID_TEXT_Point		"ID_TEXT_Point"
#endif  ID_TEXT_Point
#ifndef ID_BUTTON_PlusLiLiang
#define ID_BUTTON_PlusLiLiang		"ID_BUTTON_PlusLiLiang"
#endif  ID_BUTTON_PlusLiLiang
#ifndef ID_BUTTON_SubtractLiLiang
#define ID_BUTTON_SubtractLiLiang		"ID_BUTTON_SubtractLiLiang"
#endif  ID_BUTTON_SubtractLiLiang
#ifndef ID_BUTTON_PlusTiZhi
#define ID_BUTTON_PlusTiZhi		"ID_BUTTON_PlusTiZhi"
#endif  ID_BUTTON_PlusTiZhi
#ifndef ID_BUTTON_PlusMinJie
#define ID_BUTTON_PlusMinJie		"ID_BUTTON_PlusMinJie"
#endif  ID_BUTTON_PlusMinJie
#ifndef ID_BUTTON_PlusZhiLi
#define ID_BUTTON_PlusZhiLi		"ID_BUTTON_PlusZhiLi"
#endif  ID_BUTTON_PlusZhiLi
#ifndef ID_BUTTON_SubtractTiZhi
#define ID_BUTTON_SubtractTiZhi		"ID_BUTTON_SubtractTiZhi"
#endif  ID_BUTTON_SubtractTiZhi
#ifndef ID_BUTTON_SubtractMinJie
#define ID_BUTTON_SubtractMinJie		"ID_BUTTON_SubtractMinJie"
#endif  ID_BUTTON_SubtractMinJie
#ifndef ID_BUTTON_SubtractZhiLi
#define ID_BUTTON_SubtractZhiLi		"ID_BUTTON_SubtractZhiLi"
#endif  ID_BUTTON_SubtractZhiLi
#ifndef ID_TEXT_MountLv
#define ID_TEXT_MountLv		"ID_TEXT_MountLv"
#endif  ID_TEXT_MountLv
#ifndef ID_LIST_War
#define ID_LIST_War         "ID_LIST_War"
#endif  ID_LIST_War
#ifndef ID_TEXT_PetSpeed
#define ID_TEXT_PetSpeed		"ID_TEXT_PetSpeed"
#endif  ID_TEXT_PetSpeed
#ifndef ID_TEXT_TransferTotal
#define ID_TEXT_TransferTotal		"ID_TEXT_TransferTotal"
#endif  ID_TEXT_TransferTotal
#ifndef ID_BUTTON_Strengthen
#define ID_BUTTON_Strengthen		"ID_BUTTON_Strengthen"
#endif  ID_BUTTON_Strengthen

#ifndef ID_BUTTON_MountMoveStar
#define ID_BUTTON_MountMoveStar		"ID_BUTTON_MountMoveStar"
#endif  ID_BUTTON_MountMoveStar


class CUI_ID_FRAME_Pet : public CUIBase, public CUIRenderAnim
{
private:
    ControlFrame*	m_pID_FRAME_Pet;
    ControlText*	m_pID_TEXT_MJ;
    ControlText*	m_pID_TEXT_LL;
    ControlText*	m_pID_TEXT_TZ;
    ControlText*	m_pID_TEXT_SF;
    ControlText*	m_pID_TEXT_SYDJ;
    ControlText*	m_pID_TEXT_KLD;
    ControlText*	m_pID_TEXT_name;
    ControlText*	m_pID_TEXT_LLZZ;
    ControlText*	m_pID_TEXT_JRZZ;
    ControlText*	m_pID_TEXT_TZZZ;
    ControlText*	m_pID_TEXT_SFZZ;
    ControlList*	m_pID_LIST_ShouLan;
    ControlButton*	m_pID_BUTTON_XiuXi;
    ControlText*	m_pID_TEXT_DJ;
    ControlPicture*	m_pID_PICTURE_Yingxiang;
    ControlListImage*	m_pID_LISTIMG_ZhuDong;
    ControlText*	m_pID_TEXT_Exp;
    ControlButton*	m_pID_BUTTON_Right;
    ControlButton*	m_pID_BUTTON_Left;
    ControlText*	m_pID_TEXT_TakeNum;
    ControlButton*	m_pID_BUTTON_Feed;
    ControlListImage*	m_pID_LISTIMG_PetIcon;
    ControlListImage*	m_pID_LISTIMG_QiCheng;
    ControlText*	m_pID_TEXT_MountName;
    ControlButton*	m_pID_BUTTON_ChuZhan;
    ControlButton*	m_pID_BUTTON_FangSheng;
    ControlButton*	m_pID_BUTTON_Lock;
    ControlButton*	m_pID_BUTTON_UnLock;
    ControlButton*	m_pID_BUTTON_GaiMing;
    ControlButton*	m_pID_BUTTON_Renew;
    ControlButton*	m_pID_BUTTON_Confirm;
    ControlButton*	m_pID_BUTTON_PlusLiLiang;
    ControlButton*	m_pID_BUTTON_SubtractLiLiang;
    ControlButton*	m_pID_BUTTON_PlusTiZhi;
    ControlButton*	m_pID_BUTTON_PlusMinJie;
    ControlButton*	m_pID_BUTTON_PlusZhiLi;
    ControlButton*	m_pID_BUTTON_SubtractTiZhi;
    ControlButton*	m_pID_BUTTON_SubtractMinJie;
    ControlButton*	m_pID_BUTTON_SubtractZhiLi;
    ControlListImage*	m_pID_LISTIMG_BeiDong;
    ControlText*	m_pID_TEXT_Generation;
    ControlText*	m_pID_TEXT_Point;
    ControlList*	m_pID_LIST_War;
    ControlButton*  m_arrayButton[8];
    ControlText*	m_pID_TEXT_MountLv;
	ControlText*	m_pID_TEXT_PetSpeed;
	ControlText*	m_pID_TEXT_TransferTotal;
	ControlButton*	m_pID_BUTTON_Strengthen;
	ControlButton*	m_pID_BUTTON_MountMoveStar;

public:	
    CUI_ID_FRAME_Pet();
    bool OnFrameRun();
    bool OnFrameRender();
    void ID_LIST_ShouLanOnListSelectChange( ControlObject* pSender, ControlList::S_List* pItem );
	void ID_LIST_WarOnListSelectChange( ControlObject* pSender, ControlList::S_List* pItem );
	void ID_LIST_WarOnListLDBClick( ControlObject* pSender, ControlList::S_List* pItem );

    bool ID_BUTTON_XiuXiOnButtonClick( ControlObject* pSender );
    bool ID_LISTIMG_ZhuDongOnIconDragOn( ControlObject* pSender, ControlObject* pMe, ControlIconDrag::S_ListImg* pItemDrag, ControlIconDrag::S_ListImg* pItemSrc );
    bool ID_LISTIMG_ZhuDongOnIconLDBClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
    bool ID_LISTIMG_ZhuDongOnIconButtonClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
    bool ID_LISTIMG_ZhuDongOnIconRButtonUp( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
    bool ID_BUTTON_RightOnButtonClick( ControlObject* pSender );
    bool ID_BUTTON_LeftOnButtonClick( ControlObject* pSender );
    bool ID_BUTTON_FeedOnButtonClick( ControlObject* pSender );
    bool ID_LISTIMG_PetIconOnIconDragOn( ControlObject* pSender, ControlObject* pMe, ControlIconDrag::S_ListImg* pItemDrag, ControlIconDrag::S_ListImg* pItemSrc );
    bool ID_LISTIMG_PetIconOnIconLDBClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
    bool ID_LISTIMG_PetIconOnIconButtonClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
    bool ID_LISTIMG_PetIconOnIconRButtonUp( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
    bool ID_LISTIMG_QiChengOnIconDragOn( ControlObject* pSender, ControlObject* pMe, ControlIconDrag::S_ListImg* pItemDrag, ControlIconDrag::S_ListImg* pItemSrc );
    bool ID_LISTIMG_QiChengOnIconLDBClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
    bool ID_LISTIMG_QiChengOnIconButtonClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
    bool ID_LISTIMG_QiChengOnIconRButtonUp( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
    bool ID_BUTTON_ChuZhanOnButtonClick( ControlObject* pSender );
    bool ID_BUTTON_FangShengOnButtonClick( ControlObject* pSender );
    bool ID_BUTTON_LockOnButtonClick( ControlObject* pSender );
    bool ID_BUTTON_UnLockOnButtonClick( ControlObject* pSender );
    bool ID_BUTTON_GaiMingOnButtonClick( ControlObject* pSender );
    bool ID_BUTTON_RenewOnButtonClick( ControlObject* pSender );
    bool ID_BUTTON_ConfirmOnButtonClick( ControlObject* pSender );
    bool ID_LISTIMG_BeiDongOnIconDragOn( ControlObject* pSender, ControlObject* pMe, ControlIconDrag::S_ListImg* pItemDrag, ControlIconDrag::S_ListImg* pItemSrc );
    bool ID_LISTIMG_BeiDongOnIconLDBClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
    bool ID_LISTIMG_BeiDongOnIconButtonClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
    bool ID_LISTIMG_BeiDongOnIconRButtonUp( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
    bool ID_BUTTON_PlusLiLiangOnButtonClick( ControlObject* pSender );
    bool ID_BUTTON_SubtractLiLiangOnButtonClick( ControlObject* pSender );
    bool ID_BUTTON_PlusTiZhiOnButtonClick( ControlObject* pSender );
    bool ID_BUTTON_PlusMinJieOnButtonClick( ControlObject* pSender );
    bool ID_BUTTON_PlusZhiLiOnButtonClick( ControlObject* pSender );
    bool ID_BUTTON_SubtractTiZhiOnButtonClick( ControlObject* pSender );
    bool ID_BUTTON_SubtractMinJieOnButtonClick( ControlObject* pSender );
    bool ID_BUTTON_SubtractZhiLiOnButtonClick( ControlObject* pSender );
	bool ID_BUTTON_StrengthenOnButtonClick( ControlObject* pSender );

	bool ID_BUTTON_MountMoveStarOnButtonClick( ControlObject* pSender );
private:
    virtual bool _LoadUI();				// 载入UI
    bool DoControlConnect();	        // 关连控件
    virtual bool _UnLoadUI();			// 卸载UI
    virtual bool _IsVisable();			// 是否可见
    virtual void _SetVisable( const bool bVisable );			// 设置是否可视

public:
    void RefreshEnable( int nIndex, bool bEnable );	
    int GetMountIndexByGuid( __int64 guid );
    bool IsEqualToLISTIMG_PetIcon(ControlObject * pListImage);
    int	PenIcon_GetIndexByItem( ControlIconDrag::S_ListImg* pItem );
    ControlIconDrag::S_ListImg* PenIcon_GetItemByIndex(int index);
    void Refresh(bool bSelectEnd = false);
    void SetRotate(bool bRotate) {m_bRotate = bRotate;}
    short GetCurrentMountIndex();
    void Dismount();
    void Mount();
    bool IsActivedPet() const;
    bool IsSkillList(const ControlObject* pObject);
    void RefreshMountSkill();
    void RefreshIconInfo();
    void ChangePetName(const char* szName);
    bool IsListImageByBagType(ControlObject* pObject);
    void ChangeModel(int mountID);
    SMountItem& GetCurrentMount();
	ControlFrame* GetFrame(){return m_pID_FRAME_Pet;}

protected:
    void RefreshPetEnableList();
    bool IsMountInBargaining( __int64 guid );
    bool IsMountInPrivateShop( __int64 guid );
    bool AddPoint(EBaseAttr eKeyType);
    bool SubtractPoint(EBaseAttr eKeyType);
    void UpdataProperty();
    void SetLockAndUnLockState();
    void SetButtonGroup();
    void SetArrayEnable(bool);
    bool IsInCoolDownTime(SMountItem* pMount);
    void SetStateByCoolDownTime(SMountItem* pMount);
    void InitTextCtl();
    static void ID_LIST_ShouLanOnListLDBClick( ControlObject* pSender, ControlList::S_List* pItem );

    void ResetMembers();
    SMountItem* GetActivedMount() { return m_pActivedPet; }
    void PetSelectChanged(int nIndex);
    void ActivePet(int nIndex);
    void ActivePet(SMountItem& mount, int nIndex);
    void DiscardPet(int nIndex);
    bool HasSkill(int nId);
    void RefreshMountSkill(SMountItem& mount);
    void UpdateIconInfo();
    void InitActivePicState();
    void RefreshFightState(int);
    void RefreshFightIcon();
    void SetNeedRefresh(bool);
    void RefreshHelp(bool);
	void UsePetHp(unsigned char ucValue);

private:
    typedef struct _tagPetEnable
    {
        __int64 guid;
        bool	bEnable;
    }PetEnable;

    PetEnable           m_PetsEnable[ITEM_MOUNT_MAXCOUNT];
    SMountItem*         m_pActivedPet;
    int                 m_nModelId;

    float               m_fRotateZ;
    bool                m_bRotate;
    bool                m_bCanMount;
    int                 m_nLastHeight;

    bool                m_bActivePet[ITEM_MOUNT_MAXCOUNT];
    bool                m_bNeedRefresh;
    bool                m_bSelectEnd;
};

extern CUI_ID_FRAME_Pet s_CUI_ID_FRAME_Pet;
