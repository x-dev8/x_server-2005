/********************************************************************
	Created by UIEditor.exe
	FileName: E:\work\Hero\Program\trunk\Client\Bin\Data\Ui\EquipUpgrade.h
*********************************************************************/
#pragma once
#include "MeUi/MeUi.h"
#include "me3d/Vector.h"
#include "MeUi/Animation/SlideAnimation.h"
#include "ItemEnableChangeSysBase.h"

#ifndef ID_FRAME_EquipUpgrade
#define ID_FRAME_EquipUpgrade		"ID_FRAME_EquipUpgrade"
#endif  ID_FRAME_EquipUpgrade
#ifndef ID_PICTURE_RightTitle
#define ID_PICTURE_RightTitle		"ID_PICTURE_RightTitle"
#endif  ID_PICTURE_RightTitle
#ifndef ID_PICTURE_MiddleTitle
#define ID_PICTURE_MiddleTitle		"ID_PICTURE_MiddleTitle"
#endif  ID_PICTURE_MiddleTitle
#ifndef ID_PICTURE_LeftMiddle
#define ID_PICTURE_LeftMiddle		"ID_PICTURE_LeftMiddle"
#endif  ID_PICTURE_LeftMiddle
#ifndef ID_PICTURE_RightMiddle
#define ID_PICTURE_RightMiddle		"ID_PICTURE_RightMiddle"
#endif  ID_PICTURE_RightMiddle
#ifndef ID_BUTTON_CLOSE
#define ID_BUTTON_CLOSE		"ID_BUTTON_CLOSE"
#endif  ID_BUTTON_CLOSE
#ifndef ID_BUTTON_help
#define ID_BUTTON_help		"ID_BUTTON_help"
#endif  ID_BUTTON_help
#ifndef ID_PICTURE_ItemWall
#define ID_PICTURE_ItemWall		"ID_PICTURE_ItemWall"
#endif  ID_PICTURE_ItemWall
#ifndef ID_LISTIMG_Armour
#define ID_LISTIMG_Armour		"ID_LISTIMG_Armour"
#endif  ID_LISTIMG_Armour
#ifndef ID_BUTTON_Ok
#define ID_BUTTON_Ok		"ID_BUTTON_Ok"
#endif  ID_BUTTON_Ok
#ifndef ID_BUTTON_Cancel
#define ID_BUTTON_Cancel		"ID_BUTTON_Cancel"
#endif  ID_BUTTON_Cancel
#ifndef ID_TEXT_UseMoneyZ
#define ID_TEXT_UseMoneyZ		"ID_TEXT_UseMoneyZ"
#endif  ID_TEXT_UseMoneyZ
#ifndef ID_TEXT_UseMoney
#define ID_TEXT_UseMoney		"ID_TEXT_UseMoney"
#endif  ID_TEXT_UseMoney
#ifndef ID_PICTURE_LeftTitle
#define ID_PICTURE_LeftTitle		"ID_PICTURE_LeftTitle"
#endif  ID_PICTURE_LeftTitle
#ifndef ID_PICTURE_TitleWord
#define ID_PICTURE_TitleWord		"ID_PICTURE_TitleWord"
#endif  ID_PICTURE_TitleWord
#ifndef ID_PICTURE_ExplainWall3
#define ID_PICTURE_ExplainWall3		"ID_PICTURE_ExplainWall3"
#endif  ID_PICTURE_ExplainWall3
#ifndef ID_PICTURE_ItemWall2
#define ID_PICTURE_ItemWall2		"ID_PICTURE_ItemWall2"
#endif  ID_PICTURE_ItemWall2
#ifndef ID_TEXT_ArmourName
#define ID_TEXT_ArmourName		"ID_TEXT_ArmourName"
#endif  ID_TEXT_ArmourName
#ifndef ID_TEXT_M1Name
#define ID_TEXT_M1Name		"ID_TEXT_M1Name"
#endif  ID_TEXT_M1Name
#ifndef ID_TEXT_Word2
#define ID_TEXT_Word2		"ID_TEXT_Word2"
#endif  ID_TEXT_Word2
#ifndef ID_PICTURE_16595
#define ID_PICTURE_16595		"ID_PICTURE_16595"
#endif  ID_PICTURE_16595
#ifndef ID_LISTIMG_M1
#define ID_LISTIMG_M1		"ID_LISTIMG_M1"
#endif  ID_LISTIMG_M1
#ifndef ID_TEXT_M1Num
#define ID_TEXT_M1Num		"ID_TEXT_M1Num"
#endif  ID_TEXT_M1Num
#ifndef ID_LISTIMG_M2
#define ID_LISTIMG_M2		"ID_LISTIMG_M2"
#endif  ID_LISTIMG_M2
#ifndef ID_TEXT_M2Name
#define ID_TEXT_M2Name		"ID_TEXT_M2Name"
#endif  ID_TEXT_M2Name
#ifndef ID_TEXT_M2Num
#define ID_TEXT_M2Num		"ID_TEXT_M2Num"
#endif  ID_TEXT_M2Num
#ifndef ID_LISTIMG_M3
#define ID_LISTIMG_M3		"ID_LISTIMG_M3"
#endif  ID_LISTIMG_M3
#ifndef ID_TEXT_M3Name
#define ID_TEXT_M3Name		"ID_TEXT_M3Name"
#endif  ID_TEXT_M3Name
#ifndef ID_TEXT_M3Num
#define ID_TEXT_M3Num		"ID_TEXT_M3Num"
#endif  ID_TEXT_M3Num
#ifndef ID_LISTIMG_M4
#define ID_LISTIMG_M4		"ID_LISTIMG_M4"
#endif  ID_LISTIMG_M4
#ifndef ID_TEXT_M4Name
#define ID_TEXT_M4Name		"ID_TEXT_M4Name"
#endif  ID_TEXT_M4Name
#ifndef ID_TEXT_M4Num
#define ID_TEXT_M4Num		"ID_TEXT_M4Num"
#endif  ID_TEXT_M4Num
#ifndef ID_TEXT_Explain
#define ID_TEXT_Explain		"ID_TEXT_Explain"
#endif  ID_TEXT_Explain
#ifndef ID_LISTIMG_Armour1
#define ID_LISTIMG_Armour1		"ID_LISTIMG_Armour1"
#endif  ID_LISTIMG_Armour1
#ifndef ID_LISTIMG_Armour2
#define ID_LISTIMG_Armour2		"ID_LISTIMG_Armour2"
#endif  ID_LISTIMG_Armour2
#ifndef ID_LISTIMG_Armour3
#define ID_LISTIMG_Armour3		"ID_LISTIMG_Armour3"
#endif  ID_LISTIMG_Armour3
#ifndef ID_LISTIMG_Armour4
#define ID_LISTIMG_Armour4		"ID_LISTIMG_Armour4"
#endif  ID_LISTIMG_Armour4
#ifndef ID_TEXT_Armour1
#define ID_TEXT_Armour1		"ID_TEXT_Armour1"
#endif  ID_TEXT_Armour1
#ifndef ID_TEXT_Armour2
#define ID_TEXT_Armour2		"ID_TEXT_Armour2"
#endif  ID_TEXT_Armour2
#ifndef ID_TEXT_Armour3
#define ID_TEXT_Armour3		"ID_TEXT_Armour3"
#endif  ID_TEXT_Armour3
#ifndef ID_TEXT_Armour4
#define ID_TEXT_Armour4		"ID_TEXT_Armour4"
#endif  ID_TEXT_Armour4
#ifndef ID_LIST_ChooseItem
#define ID_LIST_ChooseItem		"ID_LIST_ChooseItem"
#endif  ID_LIST_ChooseItem
#ifndef ID_PICTURE_WeaponTitleWord
#define ID_PICTURE_WeaponTitleWord		"ID_PICTURE_WeaponTitleWord"
#endif  ID_PICTURE_WeaponTitleWord
#ifndef ID_TEXT_WeaponExplain
#define ID_TEXT_WeaponExplain		"ID_TEXT_WeaponExplain"
#endif  ID_TEXT_WeaponExplain
#ifndef ID_PICTURE_UpgradeEffect
#define ID_PICTURE_UpgradeEffect		"ID_PICTURE_UpgradeEffect"
#endif  ID_PICTURE_UpgradeEffect

enum {
		EquipUpgradeAdditionalOne = 0,
		EquipUpgradeAdditionalTwo,
		EquipUpgradeAdditionalOptional,
		EquipUpgradeAdditionalBak,
		EquipUpgradeMaxAdditional,
};
#define EquipUpgradeMaxAimNumber 4
struct MsgEquipUpgradeAck;

#include "UiBase.h"

class CUI_ID_FRAME_EquipUpgrade :public CUIBase, CItemEnableChangeSysBase
{
	// Member
public:	
	 CUI_ID_FRAME_EquipUpgrade();
private:
	 ControlFrame*	m_pID_FRAME_EquipUpgrade;
// 	 ControlPicture*	m_pID_PICTURE_RightTitle;
// 	 ControlPicture*	m_pID_PICTURE_MiddleTitle;
// 	 ControlPicture*	m_pID_PICTURE_LeftMiddle;
// 	 ControlPicture*	m_pID_PICTURE_RightMiddle;
// 	 ControlButton*	m_pID_BUTTON_CLOSE;
// 	 ControlButton*	m_pID_BUTTON_help;
// 	 ControlPicture*	m_pID_PICTURE_ItemWall;
	 ControlListImage*	m_pID_LISTIMG_Armour;
	 ControlButton*	m_pID_BUTTON_Ok;
	 ControlButton*	m_pID_BUTTON_Cancel;
	 ControlText*	m_pID_TEXT_UseMoneyZ;
	 ControlText*	m_pID_TEXT_UseMoney;
	// ControlPicture*	m_pID_PICTURE_LeftTitle;
	 ControlPicture*	m_pID_PICTURE_TitleWord;
// 	 ControlPicture*	m_pID_PICTURE_ExplainWall3;
// 	 ControlPicture*	m_pID_PICTURE_ItemWall2;
// 	 ControlText*	m_pID_TEXT_ArmourName;
	 ControlText*	m_pID_TEXT_M1Name;
	// ControlText*	m_pID_TEXT_Word2;
	 ControlPicture*	m_pID_PICTURE_16595;
	 ControlListImage*	m_pID_LISTIMG_M1;
	 ControlText*	m_pID_TEXT_M1Num;
	 ControlListImage*	m_pID_LISTIMG_M2;
	 ControlText*	m_pID_TEXT_M2Name;
	 ControlText*	m_pID_TEXT_M2Num;
	 ControlListImage*	m_pID_LISTIMG_M3;
	 ControlText*	m_pID_TEXT_M3Name;
	 ControlText*	m_pID_TEXT_M3Num;
	 ControlListImage*	m_pID_LISTIMG_M4;
	 ControlText*	m_pID_TEXT_M4Name;
	 ControlText*	m_pID_TEXT_M4Num;
	 ControlText*	m_pID_TEXT_Explain;
	 ControlListImage*	m_pID_LISTIMG_Armour1;
	 ControlListImage*	m_pID_LISTIMG_Armour2;
	 ControlListImage*	m_pID_LISTIMG_Armour3;
	 ControlListImage*	m_pID_LISTIMG_Armour4;
	 ControlText*	m_pID_TEXT_Armour1;
	 ControlText*	m_pID_TEXT_Armour2;
	 ControlText*	m_pID_TEXT_Armour3;
	 ControlText*	m_pID_TEXT_Armour4;
	 ControlList*	m_pID_LIST_ChooseItem;
	 ControlPicture*	m_pID_PICTURE_WeaponTitleWord;
	 ControlText*	m_pID_TEXT_WeaponExplain;
	 ControlPicture*	m_pID_PICTURE_UpgradeEffect;

public:
	// Frame
	bool OnFrameRun();
	bool OnFrameRender();
// 	bool ID_BUTTON_CLOSEOnButtonClick( ControlObject* pSender );
// 	bool ID_BUTTON_helpOnButtonClick( ControlObject* pSender );
	bool ID_LISTIMG_ArmourOnIconDragOn( ControlObject* pSender, ControlObject* pMe, ControlIconDrag::S_ListImg* pItemDrag, ControlIconDrag::S_ListImg* pItemSrc );
	bool ID_LISTIMG_ArmourOnIconLDBClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_ArmourOnIconButtonClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_ArmourOnIconRButtonUp( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_BUTTON_OkOnButtonClick( ControlObject* pSender );
	bool ID_BUTTON_CancelOnButtonClick( ControlObject* pSender );
	bool ID_LISTIMG_M1OnIconDragOn( ControlObject* pSender, ControlObject* pMe, ControlIconDrag::S_ListImg* pItemDrag, ControlIconDrag::S_ListImg* pItemSrc );
	bool ID_LISTIMG_M1OnIconLDBClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_M1OnIconButtonClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_M1OnIconRButtonUp( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_M2OnIconDragOn( ControlObject* pSender, ControlObject* pMe, ControlIconDrag::S_ListImg* pItemDrag, ControlIconDrag::S_ListImg* pItemSrc );
	bool ID_LISTIMG_M2OnIconLDBClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_M2OnIconButtonClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_M2OnIconRButtonUp( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_M3OnIconDragOn( ControlObject* pSender, ControlObject* pMe, ControlIconDrag::S_ListImg* pItemDrag, ControlIconDrag::S_ListImg* pItemSrc );
	bool ID_LISTIMG_M3OnIconLDBClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_M3OnIconButtonClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_M3OnIconRButtonUp( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_M4OnIconDragOn( ControlObject* pSender, ControlObject* pMe, ControlIconDrag::S_ListImg* pItemDrag, ControlIconDrag::S_ListImg* pItemSrc );
	bool ID_LISTIMG_M4OnIconLDBClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_M4OnIconButtonClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_M4OnIconRButtonUp( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_Armour1OnIconDragOn( ControlObject* pSender, ControlObject* pMe, ControlIconDrag::S_ListImg* pItemDrag, ControlIconDrag::S_ListImg* pItemSrc );
	bool ID_LISTIMG_Armour1OnIconLDBClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_Armour1OnIconButtonClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_Armour1OnIconRButtonUp( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_Armour2OnIconDragOn( ControlObject* pSender, ControlObject* pMe, ControlIconDrag::S_ListImg* pItemDrag, ControlIconDrag::S_ListImg* pItemSrc );
	bool ID_LISTIMG_Armour2OnIconLDBClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_Armour2OnIconButtonClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_Armour2OnIconRButtonUp( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_Armour3OnIconDragOn( ControlObject* pSender, ControlObject* pMe, ControlIconDrag::S_ListImg* pItemDrag, ControlIconDrag::S_ListImg* pItemSrc );
	bool ID_LISTIMG_Armour3OnIconLDBClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_Armour3OnIconButtonClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_Armour3OnIconRButtonUp( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_Armour4OnIconDragOn( ControlObject* pSender, ControlObject* pMe, ControlIconDrag::S_ListImg* pItemDrag, ControlIconDrag::S_ListImg* pItemSrc );
	bool ID_LISTIMG_Armour4OnIconLDBClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_Armour4OnIconButtonClick( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	bool ID_LISTIMG_Armour4OnIconRButtonUp( ControlObject* pSender, ControlIconDrag::S_ListImg* pItem );
	void ID_LIST_ChooseItemOnListSelectChange( ControlObject* pSender, ControlList::S_List* pItem );

	
private:
	virtual bool _LoadUI();				// 载入UI
	bool DoControlConnect();	// 关连控件
	virtual bool _UnLoadUI();			// 卸载UI
	virtual bool _IsVisable();			// 是否可见
	virtual void _SetVisable( const bool bVisable );			// 设置是否可视

public:
	void SendUpgradeEquipMsg();
	bool CanItemUpgrade(unsigned short ustItemId);
	bool IsOptionalMaterial(unsigned short utItemID);
	void SetWeaponUpgrade(bool bWeapon) {m_bWeaponUpgrade = bWeapon;}
	void SetVisiblePosition( const Vector& vPos ){ m_vVisiblePos = vPos; }
	void EquipUpdateAck(MsgEquipUpgradeAck*);
    virtual bool IsPackItemBeUsing( __int64 nGuid );

	ControlFrame* GetFrame() {return m_pID_FRAME_EquipUpgrade;}

private:
	int m_EquipItemBagIndex;
	bool m_EquipItemEnable; 
	int m_bNeedUpdate;
	int m_needMoney;

	unsigned short m_nAimItemID;

	ControlListImage* m_pAimlListImage[EquipUpgradeMaxAimNumber];
	ControlText*	m_pID_TEXT_Aim[EquipUpgradeMaxAimNumber];

	ControlListImage* m_pAdditionalListImage[EquipUpgradeMaxAdditional];
	ControlText*	m_pID_TEXT_Additional[EquipUpgradeMaxAdditional];
	ControlText*	m_pID_TEXT_AdditionalNumber[EquipUpgradeMaxAdditional];
	int m_additionalItemBagIndex[EquipUpgradeMaxAdditional];
	bool m_additionalItemEnable[EquipUpgradeMaxAdditional]; 
	bool m_bMaterialEnough[EquipUpgradeMaxAdditional]; 

	Vector m_vVisiblePos;			 // 分解界面打开时的人物位置,用来自动关闭时使用

	const Vector& GetVisiblePosition() const { return m_vVisiblePos; }
	void RefreshAllBagEnable();
	void SetEquipItemBagIndex(int index, bool enable);
	void SetEquipItem(ControlIconDrag::S_ListImg* pItem);
	void SetMaterialBagIndex(int index, bool enable,int nAdditionType);
	void SetOptionalMaterial(ControlIconDrag::S_ListImg* pItem,int nAdditionType);
	void ClearInfo();

	void ClearMaterialItemUI();
	void RefreshAimUI();

	void ClearAimUI();
	void RefreshMaterialUI();

	static void OnVisibleChanged(ControlObject* pSender);
	void ClearAnim();

	int m_iMustMaterialCount;
	bool m_bWeaponUpgrade;

	CSlideAnimation m_slideAnim;			//序列帧动画
	bool			m_bStartAnim;

	bool			m_bStartIntonate;
	int				m_nIntonateTime;		// 吟唱时间，毫秒
	DWORD			m_dwStartIntonateTime;	// 开始吟唱时间
};
extern CUI_ID_FRAME_EquipUpgrade s_CUI_ID_FRAME_EquipUpgrade;
